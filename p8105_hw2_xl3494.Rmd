---
title: "p8105_hw2_xl3494"
output: github_document
---

```{r setup}
library(tidyverse)
library(lubridate)
library(readxl)
```

# Problem 1

Clean the data in pols-month.csv:

```{r}
pols_month =
  read_csv("./fivethirtyeight_datasets/pols-month.csv")|>
  separate(mon, into = c("year", "nmonth", "day"), sep = "-", convert = TRUE) |>
  mutate(
    month = factor(tolower(month.name[nmonth]),
                   levels = tolower(month.name),
                   ordered = TRUE)) |>
  mutate(president = if_else(prez_gop == 1, "gop", "dem")) |>
  arrange(year, month) |>
  select(year, month, everything(), -nmonth, -day, -prez_gop, -prez_dem)
```

Clean the data in snp.csv:

```{r}
snp =
  read_csv("./fivethirtyeight_datasets/snp.csv")|>
  separate(date, into = c("m", "d", "yy"), sep = "/", convert = TRUE) |>
  mutate(
    year  = if_else(yy >= 50, 1900L + yy, 2000L + yy),   # 50–99 → 1950–1999；00–49 → 2000–2049
    month = factor(tolower(month.name[m]),
                   levels = tolower(month.name), ordered = TRUE)
  ) |>
  arrange(year, month) |>
  select(year, month, close)
```

Tidy the unemployment data:

```{r}
unemployment =
  read_csv("./fivethirtyeight_datasets/unemployment.csv")|>
  janitor::clean_names() |>
  pivot_longer(
    cols = -year,
    names_to  = "ab_month",
    values_to = "unemployment") |>
  mutate(
    m_idx = match(ab_month, tolower(month.abb)),             
    month = factor(tolower(month.name[m_idx]),
                   levels = tolower(month.name), ordered = TRUE)) |>
  arrange(year, month) |>
  select(year, month, unemployment)
```

Joining snp into pols_month:

```{r}
pols_snp <- pols_month |>
  left_join(snp |> rename(snp_close = close),
            by = c("year","month"))
```

Joining unemployment into result:

```{r}
pols_snp_unemp <- pols_snp |>
  left_join(unemployment, by = c("year","month"))
```

### About the datasets
The pols-month table contains the monthly counts of politicians by party -- Republican/Democratic governors, senators, and representatives, and the party of the sitting president. After cleaning, the time range is from Jan 1947 to Jun 2015 (822 rows).

The snp table holds the Standard & Poor’s stock market index (close) by year and month. After cleaning, it contains 787 rows with a time range from Jan 1950 to Jul 2015.

The unemployment table records the monthly unemployment rate (%); we pivoted it from wide (Jan–Dec columns) to long with the same keys -- year and month. The dataset contains 816 rows with a time range from Jan 1948 to Jun 2015.

The joined dataset pols_snp_unemp contains 822 rows and 11 variables. Key variables include year, month, president, party counts (gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, and rep_dem), stock market index (snp_close), and % unemployment. The final table keeps all the pol-month months from Jan 1947 to Jun 2015. The coverage of the other two dataset differs slightly: snp_close covers from Jan 1950 to Jun 2015, and unemployment covers from Jan 1948 to Jun 2015.

# Problem 2

Read in and clean the Mr. Trash Wheel sheet:

```{r}
mr = 
  read_excel("./trashwheel_data/202509 Trash Wheel Collection Data.xlsx",
                           sheet = "Mr. Trash Wheel",
                           range = "A2:N709") |>
  janitor::clean_names()|>
  filter(!is.na(dumpster)) |>
  mutate(month = tolower(month),
         year  = as.integer(readr::parse_number(year)),
         date  = as.Date(date),
         sports_balls = as.integer(round(sports_balls)),
         wheel = "mr")
```

Read in and clean the Professor Trash Wheel sheet:

```{r}
professor = 
  read_excel("./trashwheel_data/202509 Trash Wheel Collection Data.xlsx",
                           sheet = "Professor Trash Wheel",
                           range = "A2:M134") |>
  janitor::clean_names()|>
  filter(!is.na(dumpster)) |>
  mutate(month = tolower(month),
         date  = as.Date(date),
         wheel = "professor")
```

Read in and clean the Gwynns Falls Trash Wheel sheet:

```{r}
gwynns = 
  read_excel("./trashwheel_data/202509 Trash Wheel Collection Data.xlsx",
                           sheet = "Gwynns Falls Trash Wheel",
                           range = "A2:L351") |>
  janitor::clean_names()|>
  filter(!is.na(dumpster)) |>
  mutate(month = tolower(month),
         date  = as.Date(date),
         wheel = "gwynns")
```

Bind all rows:

```{r}
wheel_bind = 
  bind_rows(mr, professor, gwynns) |>
  select(wheel, dumpster, month, year, date, everything())
```

### About the dataset
The combined Trash Wheel dataset contains `r nrow(wheel_bind)` observations and `r ncol(wheel_bind)` variables spanning `r paste(range(wheel_bind$year, na.rm=TRUE), collapse = "–")`. Each row contains a dumpster with identifiers `dumpster` and `wheel` (Mr., Professor, Gwynnda), timestamp `date` (plus `year`, `month`), and material metrics such as `weight_tons`, `volume_cubic_yards`, `plastic_bottles`, `polystyrene`, `cigarette_butts`, `wrappers`, `sports_balls` (rounded to integers), and `homes_powered`. 

Professor Trash Wheel collected a total of `r format(sum(wheel_bind$weight_tons[wheel_bind$wheel=="professor"], na.rm=TRUE))` tons of trash. 

In June 2022, Gwynnda collected `r format(sum(wheel_bind$cigarette_butts[wheel_bind$wheel=="gwynns" & wheel_bind$year==2022 & tolower(wheel_bind$month)=="june"], na.rm=TRUE), big.mark="," )` cigarette butts.

# Problem 3

read in and clean zillow_data

```{r}
zori_data = 
  read_csv("./zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |>
  janitor::clean_names() |>
  select (
    region_id,
    county = county_name,
    zip_code = region_name,
    everything()) |>
  select (-region_type, -state_name, -state, -city, -metro)|>
  pivot_longer(cols = matches("^x"),
               names_to = "date_raw",
               values_to = "zori") |>
  mutate(
    date = date_raw |>
      str_remove("^x") |>
      str_replace_all("_", "-") |>
      as.Date()) |>
  mutate(
    county = county |>
      str_remove(regex("\\s*county\\b", ignore_case = TRUE)) |>
      str_squish()) |>
  select(region_id, county, zip_code, size_rank, date, zori)
```

Read in and tidy zip_code_data

```{r}
zip_code_data = 
  read_csv("./zillow_data/Zip Codes.csv") |>
  janitor::clean_names() |>
  select(county, zip_code, neighborhood, county_fips)
```

Join two datasets

```{r}
zori_final = 
   left_join(zori_data, zip_code_data,
             by = c("zip_code","county"), 
             relationship = "many-to-many") |>
  filter(!is.na(zori)) |>
  pivot_wider(
    names_from = "date",
    values_from = "zori") |>
  arrange(zip_code, neighborhood)

zori_final
```
















